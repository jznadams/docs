<h1 id="roles-and-permissions">Roles and Permissions</h1>
<p>In <a href="/tutorials/brokered-auth.html">Brokered Authentication: Securing Your Application</a>, you learn how to secure your app by using tokens to create endpoints and authenticate your users to Respoke.</p>
<p>To secure your app even further, you can use roles to limit the types of things authenticated users can do.</p>
<p><br /></p>
<h3 id="about-roles-and-permissions">About Roles and Permissions</h3>
<p>As your Respoke app grows, you may want your users to have permission to perform only specific actions against Respoke. In this section, you will learn how to <strong>create Roles for your users and assign them to an endpoint</strong> when authentication occurs.</p>
<p><br /></p>
<h4 id="concepts">Concepts</h4>
<p><strong>Permissions</strong> live in Respoke and <strong>granularly govern what user may or may not do</strong>, in Respoke.</p>
<p><strong>Permissions</strong> are granted by your application on a <strong>per-token</strong> basis.</p>
<p><strong>Roles provide a way to group permissions</strong>. They are created by you via your <a href="https://portal.respoke.io/">dev console</a> or REST API.</p>
<p><br /></p>
<h4 id="regarding-dev-mode">Regarding Dev Mode</h4>
<p>It’s only a few lines of code to get started developing with Respoke in development mode. If you have successfully logged an endpoint into Respoke and sent a message, you’re probably already using development mode. The <a href="/">Respoke Quickstart Guide</a> details how to place your Respoke app in development mode, connect, and send messages.</p>
<p>In development mode Respoke automatically assigns your endpoints a default role. This system role includes a wide set of permissions which make app setup and testing easy.</p>
<p>The <strong>development mode role</strong> consists of the following permissions:</p>
<ul>
<li>ability to list all groups that have been created</li>
<li>ability to join, leave, create, destroy, and publish to a group</li>
<li>ability to list the members of all groups</li>
</ul>
<p><br />
<strong>It’s undesirable to run your app in development mode all the time.</strong> As your app matures, you’ll want to use roles to limit what your app can do depending on what type of user is authenticated as an endpoint. If you like, you can keep it simple and use a single role for many endpoints, but at least force users to authenticate to your server before letting them connect to Respoke.</p>
<p><br /></p>
<h4 id="how-to-create-custom-roles">How To Create Custom Roles</h4>
<p>The real power in Roles comes from how you customize them to fit your needs.</p>
<ol>
<li>Select the app you’d like this role to be associated with.</li>
<li>Custom roles require that your app is using <a href="/tutorials/brokered-auth.html">brokered auth</a>, so you may have to put your app out of development mode. Head over to your <a href="https://portal.respoke.io/">dev console</a> to do that.</li>
<li>Create a new role. Give it a unique name, like “general web visitors”.</li>
<li>Set some permissions.<ul>
<li>toggle the ability to media relay services (so audio and video calls work in more complex network scenarios)</li>
<li>allow subscribing and unsubscribing from app administrative events</li>
<li>allow specific actions to be performed on groups of specific names</li>
<li>allow calling to regular telephone numbers by specifying a list of numbers in the form “+15558675309”. Use “*” in the list to allow calling to all numbers.</li>
</ul>
</li>
</ol>
<p><em>Configuring App Administrative Events</em></p>
<p>Leaving this section blank will result in attempts to subscribe or unsubscribe to app events being refused.</p>
<pre><code>{
    &quot;subscribe&quot;: false,
    &quot;unsubscribe&quot;: false,
}
</code></pre><p><em>Configuring Groups Permissions</em></p>
<p>Leaving this section blank will result in attempts to perform any of these actions on groups of any name being refused. For more information on how to construct these configurations, read on to the next section.</p>
<pre><code>{
    &quot;list&quot;: true,
    &quot;myGroupName&quot;: {
        &quot;subscribe&quot;: false,
        &quot;unsubscribe&quot;: false,
        &quot;create&quot;: false,
        &quot;destroy&quot;: false,
        &quot;publish&quot;: false,
        &quot;getsubscribers&quot;: false
    }
}
</code></pre><p><br /></p>
<h4 id="how-to-construct-permissions-on-a-group">How To Construct Permissions on a Group</h4>
<p>Group permissions match a group’s name against a permissions rule. You can create a rule with the exact name of the group, with a prefix and a wildcard, or with only a wildcard to match all group names. Respoke will take the most specific rule it can find based on the group’s name and use that set of permissions.</p>
<p><em>Example</em></p>
<p>Assume you have the following group rules:</p>
<ul>
<li><code>*</code></li>
<li><code>admin</code></li>
<li><code>buddylistroom*</code></li>
<li><code>buddylistcontrol</code></li>
</ul>
<p><br />
Your app sends a request for an endpoint using these rules to join the group <code>buddylistroom5</code>. Respoke will match that group name against the <code>buddylistroom*</code> rule and use the permissions attached to that rule to authorize the endpoint to join the group. If the app sends a request for an endpoint using these rules to join the group <code>testgroup</code>, Respoke will match on the wildcard rule <code>*</code> and use those permissions to determine if the endpoint is allowed to join.</p>
<p>Respoke uses the longest match paradigm, so for rules like <code>buddy*</code>, <code>buddylist*</code>, and <code>buddylistroom*</code>, a request to join <code>buddylistroom1</code> will only match the <code>buddylistroom*</code> rule.</p>
<p><br /></p>
<h3 id="create-roles-programmatically-with-respoke-s-rest-api">Create Roles Programmatically with Respoke’s REST API</h3>
<p>Eventually, you may need to create roles programmatically. You can do this with <a href="/reference/rest-api.html">Respoke’s REST API</a> using an App Secret or Admin-Token header.</p>
<p>Here’s an example of how you could recreate the development mode role as a proper role.</p>
<pre><code class="xml">POST http://api.respoke.io/v1/roles
Content-Type: application/json
App-Secret OR Admin-Token: 28B061B9-A0D4-4E52-A0ED-EB6EA125F82A</code></pre>


<pre><code>{
    &quot;appId&quot;: &quot;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&quot;,
    &quot;name&quot;: &quot;development-mode&quot;,
    &quot;mediaRelay&quot;: false,
    &quot;events&quot;: {
        &quot;subscribe&quot;: false,
        &quot;unsubscribe&quot;: false,
    },
    &quot;groups&quot;: {
        &quot;list&quot;: true,
        &quot;*&quot;: {
            &quot;subscribe&quot;: true,
            &quot;unsubscribe&quot;: true,
            &quot;create&quot;: true,
            &quot;destroy&quot;: true,
            &quot;publish&quot;: true,
            &quot;getsubscribers&quot;: true
        }
    }
}
</code></pre><p>Here’s how you could recreate the role listed above in the Create Custom Roles section.</p>
<pre><code class="xml">POST http://api.respoke.io/v1/roles
Content-Type: application/json
App-Secret OR Admin-Token: 28B061B9-A0D4-4E52-A0ED-EB6EA125F82A</code></pre>

<pre><code>{
    &quot;appId&quot;: &quot;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX&quot;,
    &quot;name&quot;: &quot;general-visitor&quot;,
    &quot;mediaRelay&quot;: true,
    &quot;events&quot;: {
        &quot;subscribe&quot;: false,
        &quot;unsubscribe&quot;: false,
    },
    &quot;groups&quot;: {
        &quot;list&quot;: true,
        &quot;*&quot;: {
            &quot;subscribe&quot;: false,
            &quot;unsubscribe&quot;: false,
            &quot;create&quot;: false,
            &quot;destroy&quot;: false,
            &quot;publish&quot;: false,
            &quot;getsubscribers&quot;: false
        },
        &quot;admin&quot;: {
            &quot;subscribe&quot;: false,
            &quot;unsubscribe&quot;: false,
            &quot;create&quot;: false,
            &quot;destroy&quot;: false,
            &quot;publish&quot;: false,
            &quot;getsubscribers&quot;: false
        },
        &quot;buddylist-room*&quot;: {
            &quot;subscribe&quot;: true,
            &quot;unsubscribe&quot;: true,
            &quot;create&quot;: true,
            &quot;destroy&quot;: false,
            &quot;publish&quot;: true,
            &quot;getsubscribers&quot;: true
        },
        &quot;buddylist-control&quot;: {
            &quot;subscribe&quot;: true,
            &quot;unsubscribe&quot;: false,
            &quot;create&quot;: false,
            &quot;destroy&quot;: false,
            &quot;publish&quot;: true,
            &quot;getsubscribers&quot;: false
        }
    }
}
</code></pre><p>Both of these API calls will return the same role you’ve just sent with the addition of a unique identifier named <code>id</code> that you’ll need to pass into the request you’ll use to make tokens for your endpoints in brokered authentication.</p>
<p>Now that you have a few custom roles, all you need to do is start creating tokens that use them. As the <a href="/tutorials/brokered-auth.html">Brokered Authentication</a> article says, this is done inside your server-side auth broker app with the <code>id</code> (named <code>roleId</code>) that each role you created was assigned.</p>
<pre><code class="xml">POST https://api.respoke.io/v1/tokens
Content-Type: application/json
App-Secret: 28B061B9-A0D4-4E52-A0ED-EB6EA125F82A
</code></pre>

<pre><code>{
    &quot;appId&quot;: &quot;34A9DDB9-D4AO-52AA-0ADE-EABEA521F2BA&quot;,
    &quot;endpointId&quot;: &quot;bobsmith&quot;,
    &quot;roleId&quot;: &quot;96070A0D-32B1-4B8C-9353-FE3E6A5E6C1D&quot;,
    &quot;ttl&quot;: 86400
}
</code></pre><p>Now all API calls made by the app that is authenticated as “bobsmith” will be tested against this role before being authorized.</p>
