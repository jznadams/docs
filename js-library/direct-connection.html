<!DOCTYPE html>
<html lang="en" ng-app="padd">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <title>Direct Connections - 
    </title>
    <meta name="keywords" content="">
    <meta name="keywords" content="">
    <link rel="shortcut icon" type="image/ico" href="https://www.respoke.io/favicon.ico">
    <link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700|Source+Code+Pro">
    <link rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
    <link type="text/css" rel="stylesheet" href="https://www.respoke.io/min/production.css">
    <link rel="stylesheet" href="https://yandex.st/highlightjs/8.0/styles/docco.min.css">
    <link type="text/css" rel="stylesheet" href="/css/site.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.13/angular.min.js"></script>
    <script src="https://yandex.st/highlightjs/8.0/highlight.min.js"></script>
    <script src="/js/padd.js"></script>
  </head>
  <body data-spy="scroll" data-target=".secondary-nav">
    <div id="wrap">
      <div class="public-site">
        <div ng-controller="NavController" class="topbar-wrapper opaque">
          <div bfind-class-foo="@isexcited" class="navigation">
            <div onclick="$(this).next().find('ul.nav-items').toggle()" class="nav-menu-button">
              <ul>
                <li></li>
                <li></li>
                <li></li>
              </ul>
            </div>
            <div class="nav-container"><a href="" class="www-link"><img src="https://www.respoke.io/images/logo_respoke.png" class="logo"></a>
              <ul ng-show="menuVisibility !== false" class="nav-items">
                <li><a href="/#howitworks" class="www-link">How it works</a></li>
                <li><a href="/#pricing" class="www-link">Pricing</a></li>
                <li><a href="/">Docs</a></li>
                <li><a href="http://community.respoke.io">Community</a></li>
                <li><a href="/#login" class="visible-xs log-in">log in</a></li>
                <li><a href="javascript:void(0)" onclick="logout()" class="visible-xs log-out">log out</a></li>
                <li><a href="/#sign-up-form" class="visible-xs sign-up">Sign Up</a></li>
                <li><a href="" class="visible-xs portal">PORTAL</a></li>
              </ul>
              <div ng-show="menuVisibility !== false" class="buttons"><a href="/#login" class="log-in www-link">log in</a><a href="javascript:void(0)" onclick="logout()" class="log-out">log out</a><a href="/#sign-up-form" class="sign-up www-link">Sign Up</a><a href="" class="portal">PORTAL</a></div>
            </div>
          </div>
        </div>
        <!-- Main Page Content-->
        <region>
          <div ng-controller="NavController" class="how-it-works">
            <div class="how-it-works-container">
              <div id="content">
                <div class="row">
                  <div class="col-md-2">
                    <div id="main-sidebar-wrap">
                      <ul id="main-sidebar" class="nav affix">
                        <li>Respoke Concepts
                          <ul>
                            <li ng-class="{ active: currentPage === '/' }"><a href="/">Quickstart</a></li>
                            <li ng-class="{ active: currentPage === ('/concepts/brokered-auth.html') }"><a href="/concepts/brokered-auth.html">Authentication</a></li>
                            <li ng-class="{ active: currentPage === ('/concepts/calling-to-and-from-a-phone.html') }"><a href="/concepts/calling-to-and-from-a-phone.html">Calling to and from a Phone</a></li>
                            <li ng-class="{ active: currentPage === ('/concepts/connecting-with-asterisk.html') }"><a href="/concepts/connecting-with-asterisk.html">Connecting with Asterisk</a></li>
                            <li ng-class="{ active: currentPage === ('/concepts/libraries.html') }"><a href="/concepts/libraries.html">Libraries</a></li>
                            <li ng-class="{ active: currentPage === ('/concepts/rest-api.html') }"><a href="/concepts/rest-api.html">REST API Routes</a></li>
                            <li ng-class="{ active: currentPage === ('/concepts/roles-and-permissions.html') }"><a href="/concepts/roles-and-permissions.html">Roles &amp; Permissions</a></li>
                          </ul>
                        </li>
                        <li ng-class="{ active: currentPage === '/changelog.html' }"><a href="/changelog.html">Changelog</a></li>
                        <li>&nbsp;</li>
                        <li>Javascript Client
                          <ul>
                            <li><a href="http://respoke.github.io/respoke" target="_blank">Reference&nbsp;<i class="glyphicon glyphicon-share"></i></a></li>
                            <li ng-class="{ active: currentPage === ('/js-library/direct-connection.html') }"><a href="/js-library/direct-connection.html">Direct Connections</a></li>
                            <li ng-class="{ active: currentPage === ('/js-library/example-apps.html') }"><a href="/js-library/example-apps.html">Example Apps</a></li>
                            <li ng-class="{ active: currentPage === ('/js-library/respoke-js-logs.html') }"><a href="/js-library/respoke-js-logs.html">Respoke.js Logs</a></li>
                            <li ng-class="{ active: currentPage === ('/js-library/video-chat.html') }"><a href="/js-library/video-chat.html">Video Chat</a></li>
                          </ul>
                        </li>
                        <li>Admin API
                          <ul>
                            <li>Coming soon</li>
                          </ul>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="col-md-7">
                    <div class="content-wrap">
                      <button id="sidebar-toggle-button" onclick="$('#main-sidebar').toggle();$(this).find('i.glyphicon').toggleClass('hide');" class="btn btn xl btn-primary"><i class="glyphicon glyphicon-th-list"></i><i class="glyphicon glyphicon-remove hide"></i></button>
                      <article class="article">
                        <section class="content"><h1 id="using-direct-connections">Using Direct Connections</h1>
<p>Direct connections provide a way to send messages from one endpoint to another without going through Respoke’s cloud infrastructure. This quick guide should help you build a <strong>secure direct-messaging app</strong> in about 10 minutes. This tutorial uses development mode for ease of development, but all apps should be converted to using <a href="/tutorials/brokered-auth.html">brokered authentication</a> before being published.</p>
<h3 id="assumptions">Assumptions</h3>
<ol>
<li>You have a Respoke account and an app ID.</li>
</ol>
<h3 id="step-1-html-scaffold">Step 1: HTML Scaffold</h3>
<p>You can either use a real web server or something like <a href="http://jsfiddle.net">JSFiddle</a>. This is <strong>strictly client-side</strong> stuff (HTML, CSS and JavaScript) so you won’t need any server-side tech.</p>
<pre><code>&lt;html&gt;
    &lt;head&gt;
        &lt;!-- Respoke client library --&gt;
        &lt;script src=&quot;https://cdn.respoke.io/respoke.min.js&quot;&gt;&lt;/script&gt;

        &lt;!-- jQuery, for this example --&gt;
        &lt;script src=&quot;http://code.jquery.com/jquery-1.11.0.min.js&quot;&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h3 id=&quot;status&quot;&gt;Not Connected&lt;/h3&gt;
        &lt;div id=&quot;login&quot;&gt;
            User Name:
            &lt;input id=&quot;endpoint&quot; type=&quot;text&quot; /&gt;
            &lt;input id=&quot;doLogin&quot; type=&quot;button&quot; value=&quot;Connect&quot; /&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>We’re using jQuery here, but you’re welcome to use whatever library you prefer. Respoke has no dependencies.</p>
<p><em>Pro Tip: If you’re using JSFiddle, only add the stuff inside the &lt;body&gt; tag to the HTML panel, add jQuery using the Frameworks &amp; Extensions box, and drop the Respoke library URL from the second &lt;script&gt; tag to the External Resources list.</em></p>
<p>Add some optional CSS:</p>
<pre><code>body {
    font-family: Arial, Helvetica;
    margin-left: 25px;
}
</code></pre><h3 id="step-2-connecting-to-respoke">Step 2: Connecting To Respoke</h3>
<p>The first thing your client will need to do is connect to Respoke. All that takes is a ‘client’ object and an access token.</p>
<pre><code>// Put your app ID from the Respoke developer console here
var appid = &quot;dc0feacb-13c7-44c8-ad19-0acdd3c6a9dd&quot;;
var directConnection = null;

$(&quot;#sendMessage&quot;).attr(&#39;disabled&#39;, true);
$(&quot;#closeDirectConnection&quot;).attr(&#39;disabled&#39;, true);
$(&quot;#openDirectConnection&quot;).attr(&#39;disabled&#39;, true);

// create a client object using the App ID
var client = new respoke.Client({
    appId: appid,
    developmentMode: true
});

// listen for the &#39;connect&#39; event
client.listen(&#39;connect&#39;, function() {
    $(&quot;#status&quot;).html(&quot;Connected to Respoke!&quot;);
    $(&quot;#openDirectConnection&quot;).attr(&#39;disabled&#39;, false);
});

// now connect when the user clicks the &#39;Connect&#39; button
$(&quot;#doLogin&quot;).click(function() {
    var endpoint = $(&quot;#endpoint&quot;).val();
    client.connect({
         endpointId: endpoint
    });
});
</code></pre><p>Once you have that in place, run it. You should see the page load with a “Not Connected” status.</p>
<p>Enter a name - whatever you want - in the User Name box and click the ‘Connect’ button. The status box should update to read “Connected To Respoke!”, and the “Open Direct Connection” button will be enabled.</p>
<h3 id="step-3-opening-a-direct-connection">Step 3: Opening a Direct Connection</h3>
<p>Ok, so you’re connected. Time to really have some fun.</p>
<p>Add a bit more to your HTML scaffold by replacing the whole body tag with the following:</p>
<pre><code>&lt;body&gt;
    &lt;h3 id=&quot;status&quot;&gt;Not Connected&lt;/h3&gt;
    &lt;div id=&quot;login&quot;&gt;
        User Name:
        &lt;input id=&quot;endpoint&quot; type=&quot;text&quot; /&gt;
        &lt;input id=&quot;doLogin&quot; type=&quot;button&quot; value=&quot;Connect&quot; /&gt;
    &lt;/div&gt;
    &lt;div id=&quot;messaging&quot;&gt;
        &lt;ul id=&quot;messages&quot;&gt;&lt;/ul&gt;&lt;br /&gt;
        Connect To:
        &lt;input id=&quot;remoteId&quot; type=&quot;text&quot; /&gt;&lt;br /&gt;
        &lt;textarea id=&quot;textToSend&quot; rows=&quot;2&quot;&gt;&lt;/textarea&gt;&lt;br /&gt;
        &lt;input id=&#39;sendMessage&#39; type=&#39;button&#39; value=&#39;Send Message&#39; /&gt;
        &lt;input id=&#39;openDirectConnection&#39; type=&#39;button&#39; value=&#39;Open Direct Connection&#39; /&gt;
        &lt;input id=&#39;closeDirectConnection&#39; type=&#39;button&#39; value=&#39;Close Direct Connection&#39; /&gt;
    &lt;/div&gt;
&lt;/body&gt;
</code></pre><p>To start and stop a direct connection, add a button click listener that will initiate the direct connection and another one for closing it.</p>
<pre><code>// Open a direct connection
$(&quot;#openDirectConnection&quot;).click(function() {
    var endpoint = client.getEndpoint({&quot;id&quot; : $(&quot;#remoteId&quot;).val()});
    directConnection = endpoint.startDirectConnection();
});

// Close a direct connection
$(&quot;#closeDirectConnection&quot;).click(function() {
    if (directConnection) {
        directConnection.hangup();
        directConnection = null;
    }
});
</code></pre><p>And add some code to accept a direct connection another endpoint has initiated.</p>
<pre><code>// listen for and answer incoming direct connections
client.listen(&#39;direct-connection&#39;, function(evt) {
     directConnection = evt.directConnection;
     directConnection.accept();
     directConnection.listen(&#39;open&#39;, function() {
         $(&quot;#remoteId&quot;).val(evt.endpoint.id);
         $(&quot;#openDirectConnection&quot;).attr(&#39;disabled&#39;, true);
         $(&quot;#sendMessage&quot;).attr(&#39;disabled&#39;, false);
         $(&quot;#closeDirectConnection&quot;).attr(&#39;disabled&#39;, false);
     });
     directConnection.listen(&#39;close&#39;, function() {
         $(&quot;#openDirectConnection&quot;).attr(&#39;disabled&#39;, false);
         $(&quot;#sendMessage&quot;).attr(&#39;disabled&#39;, true);
         $(&quot;#closeDirectConnection&quot;).attr(&#39;disabled&#39;, true);
         directConnection = null;
     });
     // listen for incoming messages
     directConnection.listen(&#39;message&#39;, function(evt) {
        console.log(&#39;message&#39;, evt);
        $(&quot;#messages&quot;).append(&quot;&lt;li&gt;&quot;+evt.message.message+&quot;&lt;/li&gt;&quot;);
    });
});
</code></pre><p>Now when you type the name of another endpoint into the “Connect To” input box and click “Open Direct Connection”, a direct connection will be initiated and automatically accepted by the other party.</p>
<p>You can test this in by opening your app in two different tabs and connecting with two different endpoint IDs. When the direct connection opens, the “Send Message” and “Close Direct Connection” buttons will become enabled. Your endpoint ID will be added to the other party’s “Connect To” input box when the direct connection opens.</p>
<h3 id="step-4-sending-messages">Step 4: Sending Messages</h3>
<p>To receive messages, add a listener to the client that formats the message and adds it to the screen.</p>
<pre><code>// listen for incoming messages
client.listen(&#39;message&#39;, function(evt) {
    $(&quot;#messages&quot;).append(&quot;&lt;li&gt;&quot;+evt.message.message+&quot;&lt;/li&gt;&quot;);
});
</code></pre><p>To send a message, you just need to have a reference to the directConnection object, and use its <a href="/js-library/respoke.DirectConnection.html#sendMessage">sendMessage()</a> method:</p>
<pre><code>// send a message to the far-end party
$(&quot;#sendMessage&quot;).click(function(){
    if (!directConnection) {
        return;
    }

    // grab the text to send
    var messageText = $(&quot;#textToSend&quot;).val();

    // send it
    directConnection.sendMessage({&quot;message&quot; : messageText});
});
</code></pre><p>Some additional CSS will help the layout.</p>
<pre><code>#messages {
    height: 400px;
    width: 400px;
    border: 1px solid #c7c7c7;
    overflow-x: hidden;
    overflow-y: auto;
    padding: 5px;
}

#textToSend {
    width: 400px;
    padding: 5px;
}
</code></pre><p><br /></p>
<h4 id="-test-messaging-"><strong>Test messaging</strong></h4>
<p>Open the page in two different tabs. Log in using a different name on each.</p>
<p>Enter the name of the <em>other</em> login into the “Connect To” box.</p>
<p>Click “Open Direct Connection” and wait until the “Send Message” button is enabled.</p>
<p>Add a message and hit the “Send Message” button. The message should appear in the other users’s messages box.</p>
<h3 id="the-whole-enchilada">The Whole Enchilada</h3>
<p>Now you’ve got a very small app with secure, encrypted peer-to-peer messaging!</p>
<p><a href="http://jsfiddle.net/respoke/u0n1jc5o/">Try it live &raquo;</a></p>
<h3 id="html">HTML</h3>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta name=&quot;description&quot; content=&quot;Respoke Direct Connection Demo App&quot; /&gt;
    &lt;script type=&#39;text/javascript&#39; src=&#39;http://code.jquery.com/jquery-2.1.0.min.js&#39;&gt;&lt;/script&gt;
    &lt;script type=&#39;text/javascript&#39; src=&#39;https://cdn.respoke.io/respoke.min.js&#39;&gt;&lt;/script&gt;
&lt;/head&gt;
    &lt;body&gt;
        &lt;h3 id=&quot;status&quot;&gt;Not Connected&lt;/h3&gt;
        &lt;div id=&quot;login&quot;&gt;
            User Name:
            &lt;input id=&quot;endpoint&quot; type=&quot;text&quot; /&gt;
            &lt;input id=&quot;doLogin&quot; type=&quot;button&quot; value=&quot;Connect&quot; /&gt;
        &lt;/div&gt;
        &lt;div id=&quot;messaging&quot;&gt;
            &lt;ul id=&quot;messages&quot;&gt;&lt;/ul&gt;&lt;br /&gt;
            Connect To:
            &lt;input id=&quot;remoteId&quot; type=&quot;text&quot; /&gt;&lt;br /&gt;
            &lt;textarea id=&quot;textToSend&quot; rows=&quot;2&quot;&gt;&lt;/textarea&gt;&lt;br /&gt;
            &lt;input id=&#39;sendMessage&#39; type=&#39;button&#39; value=&#39;Send Message&#39; /&gt;
            &lt;input id=&#39;openDirectConnection&#39; type=&#39;button&#39; value=&#39;Open Direct Connection&#39; /&gt;
            &lt;input id=&#39;closeDirectConnection&#39; type=&#39;button&#39; value=&#39;Close Direct Connection&#39; /&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="css">CSS</h3>
<pre><code>body {
    font-family: Arial, Helvetica;
    margin-left: 25px;
}

#messages {
    height: 200px;
    width: 400px;
    border: 1px solid #c7c7c7;
    overflow-x: hidden;
    overflow-y: auto;
    padding: 5px;
}

#textToSend {
    width: 400px;
    padding: 5px;
}
</code></pre><h3 id="javascript">JavaScript</h3>
<pre><code>var appid = &quot;dc0feacb-13c7-44c8-ad19-0acdd3c6a9dd&quot;;
var directConnection = null;
$(&quot;#sendMessage&quot;).attr(&#39;disabled&#39;, true);
$(&quot;#closeDirectConnection&quot;).attr(&#39;disabled&#39;, true);
$(&quot;#openDirectConnection&quot;).attr(&#39;disabled&#39;, true);

// create a client object using the App ID value from Step 2
var client = new respoke.Client({
    appId: appid,
    developmentMode: true
});

// listen for the &#39;connect&#39; event
client.listen(&#39;connect&#39;, function() {
    $(&quot;#status&quot;).html(&quot;Connected to Respoke!&quot;);
    $(&quot;#openDirectConnection&quot;).attr(&#39;disabled&#39;, false);
});

// listen for incoming messages
client.listen(&#39;message&#39;, function(evt) {
    $(&quot;#messages&quot;).append(&quot;&lt;li&gt;&quot;+evt.message.message+&quot;&lt;/li&gt;&quot;);
});

// listen for and answer incoming direct connections
client.listen(&#39;direct-connection&#39;, function(evt) {
     directConnection = evt.directConnection;
     directConnection.accept();
     directConnection.listen(&#39;open&#39;, function() {
         $(&quot;#remoteId&quot;).val(evt.endpoint.id);
         $(&quot;#openDirectConnection&quot;).attr(&#39;disabled&#39;, true);
         $(&quot;#sendMessage&quot;).attr(&#39;disabled&#39;, false);
         $(&quot;#closeDirectConnection&quot;).attr(&#39;disabled&#39;, false);
     });
     directConnection.listen(&#39;close&#39;, function() {
         $(&quot;#openDirectConnection&quot;).attr(&#39;disabled&#39;, false);
         $(&quot;#sendMessage&quot;).attr(&#39;disabled&#39;, true);
         $(&quot;#closeDirectConnection&quot;).attr(&#39;disabled&#39;, true);
         directConnection = null;
     });
     // listen for incoming messages
     directConnection.listen(&#39;message&#39;, function(evt) {
         $(&quot;#messages&quot;).append(&quot;&lt;li&gt;&quot;+evt.message.message+&quot;&lt;/li&gt;&quot;);
     });
});

// now connect when the user clicks the &#39;Connect&#39; button
$(&quot;#doLogin&quot;).click(function() {
    var endpoint = $(&quot;#endpoint&quot;).val();
    client.connect({
         endpointId: endpoint
    });
});

// send a message to the far-end party
$(&quot;#sendMessage&quot;).click(function(){
    if (!directConnection) {
        return;
    }

    // grab the text to send
    var messageText = $(&quot;#textToSend&quot;).val();

    // send it
    directConnection.sendMessage({&quot;message&quot; : messageText});
});

// Create a direct connection
$(&quot;#openDirectConnection&quot;).click(function() {
    var endpoint = client.getEndpoint({&quot;id&quot; : $(&quot;#remoteId&quot;).val()});
    directConnection = endpoint.startDirectConnection();
});

// close the direct connection
$(&quot;#closeDirectConnection&quot;).click(function() {
    if (directConnection) {
        directConnection.hangup();
        directConnection = null;
    }
});
</code></pre><p><br /></p>
<p><a href="/tutorials/video-chat.html">Now you’re ready for video!</a></p>
</section>
                      </article><br><br><br><br>
                    </div>
                  </div>
                  <div class="col-md-3">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </region>
      </div>
      <!-- Footer-->
      <region>
        <footer>
          <div class="content-wrap">
            <section class="copy">
              <div class="footer">
                <div class="footer-container">
                  <div class="footer-links"><a href="http://digium.com/respoke"><img src="/images/digium_white.png" class="digium-logo"></a></div>
                  <div class="footer-content">
                    <p class="copy">Copyright &copy; 2014 D.C.S, LLC</p>
                    <p class="copy"><a href="mailto:info@respoke.io">info@respoke.io</a></p>
                  </div>
                  <div class="footer-links social-links"><a href="https://twitter.com/respoke"><span class="fa fa-twitter"></span></a><a href="https://www.facebook.com/respokeIO"><span class="fa fa-facebook"></span></a><a href="https://plus.google.com/110089434291590810767" rel="publisher"><span class="fa fa-google-plus"></span></a></div>
                </div>
              </div>
            </section>
          </div>
        </footer>
      </region>
    </div>
  </body>
</html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stellar.js/0.6.2/jquery.stellar.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script>
  // Scrollspy
  // TODO: use angular-ui boostrap version instead
  $('body').scrollspy({ target: '.secondary-nav', offset: 150 });
  
  // parallax by http://markdalgleish.com/projects/stellar.js/
  $.stellar();
  
  // affixing the sidebar at high resolutions
  var resizeEvent = function(event){
    if($(window).width() > 990) {
        affixLeftSidebar();
    }
  };
  window.addEventListener('resize', resizeEvent);
  resizeEvent();
  
  // Showing and login and signup
  (function () {
      var token = $.cookie('token');
      var $login = $('.log-in');
      var $logout = $('.log-out');
      var $signup = $('.sign-up');
      var $portal = $('.portal');
      var $wwwlink = $('.www-link');
      var $logo = $('img.logo');
  
      function loggedIn() {
          $login.remove();
          $signup.remove();
  
          $portal.css('display', 'inline-block');
          $logout.css('display', 'inline-block');
      }
      function notLoggedIn() {
          $portal.remove();
          $logout.remove();
  
          //- $login.css('display', 'inline-block');
          //- $signup.css('display', 'inline-block');
      }
  
      var apiBase = window.location.host.replace('docs', 'api').replace(':2003', ':2000');
      var apiUrl = apiBase.indexOf('testing.digiumlabs.com') !== -1 ? 'http://' : 'https://';
      apiUrl += apiBase + '/v1/admins/me';
      var publicBase = window.location.host.replace('docs', 'www').replace(':2003', ':2001');
      var publicUrl = publicBase.indexOf('testing.digiumlabs.com') !== -1 ? 'http://' : 'https://';
      publicUrl += publicBase;
      var portalBase = window.location.host.replace('docs', 'portal').replace(':2003', ':2002');
      var portalUrl = portalBase.indexOf('testing.digiumlabs.com') !== -1 ? 'http://' : 'https://';
      portalUrl += portalBase;
  
      if (token) {
          $.ajax({
              url: apiUrl,
              type: 'GET',
              headers: {
                  'Admin-Token': token
              },
              success: loggedIn,
              error: notLoggedIn
          });
      }
      else {
          notLoggedIn();
      }
  
      $portal.attr('href', portalUrl + $portal.attr('href'));
      $wwwlink.each(function () {
          $(this).attr('href', publicUrl + $(this).attr('href'))
      });
      $logo.attr('src', publicUrl + $logo.attr('src').replace('https://www.respoke.io',''));
  })();
  
  function logout() {
      $.removeCookie('token', { domain: '.' + window.location.hostname.split('.').slice(-2).join('.') });
      window.location.reload();
  }
  
  $.ajax({
        url: '//d3px1qgagsf6ei.cloudfront.net/Scripts/f772acdb-7c45-430c-8c5a-28c3bcbb420e',
        crossDomain: true,
        dataType: 'script',
        success: function () {
            Payboard.Events.trackPage;
        },
        error: function () {
            console.log("There was an error retrieving the payboard tracking script");
        }
    });
</script>