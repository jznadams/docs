<!DOCTYPE html><html lang=en ng-app=padd><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"><title>Authentication -</title><meta name=keywords><meta name=keywords><link rel="shortcut icon" type=image/ico href=https://www.respoke.io/favicon.ico><link type=text/css rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700|Source+Code+Pro"><link rel=stylesheet type=text/css href=https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css><link rel=stylesheet type=text/css href=https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css><link type=text/css rel=stylesheet href=https://www.respoke.io/min/production.css><link rel=stylesheet href=https://yandex.st/highlightjs/8.0/styles/docco.min.css><link type=text/css rel=stylesheet href=/css/site.css><script src=https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.13/angular.min.js></script><script src=https://yandex.st/highlightjs/8.0/highlight.min.js></script><script src=/js/padd.js></script></head><body data-spy=scroll data-target=.secondary-nav><div id=wrap><div class=public-site><div ng-controller=NavController class="topbar-wrapper opaque"><div bfind-class-foo=@isexcited class=navigation><div onclick="$(this).next().find('ul.nav-items').toggle()" class=nav-menu-button><ul><li></li><li></li><li></li></ul></div><div class=nav-container><a class=www-link><img src=https://www.respoke.io/images/logo_respoke.png class=logo></a><ul ng-show="menuVisibility !== false" class=nav-items><li><a href=/#howitworks class=www-link>How it works</a></li><li><a href=/#pricing class=www-link>Pricing</a></li><li><a href="/">Docs</a></li><li><a href=http://community.respoke.io>Community</a></li><li><a href=/#login class="visible-xs log-in">log in</a></li><li><a href=javascript:void(0) onclick=logout() class="visible-xs log-out">log out</a></li><li><a href=/#sign-up-form class="visible-xs sign-up">Sign Up</a></li><li><a class="visible-xs portal">PORTAL</a></li></ul><div ng-show="menuVisibility !== false" class=buttons><a href=/#login class="log-in www-link">log in</a><a href=javascript:void(0) onclick=logout() class=log-out>log out</a><a href=/#sign-up-form class="sign-up www-link">Sign Up</a><a class=portal>PORTAL</a></div></div></div></div><region><div ng-controller=NavController class=how-it-works><div class=how-it-works-container><div id=content><div class=row><div class=col-md-2><div id=main-sidebar-wrap><ul id=main-sidebar class="nav affix"><li>Respoke Concepts<ul><li ng-class="{ active: currentPage === '/' }"><a href="/">Quickstart</a></li><li ng-class="{ active: currentPage === ('/concepts/brokered-auth.html') }"><a href=/concepts/brokered-auth.html>Authentication</a></li><li ng-class="{ active: currentPage === ('/concepts/calling-to-and-from-a-phone.html') }"><a href=/concepts/calling-to-and-from-a-phone.html>Calling to and from a Phone</a></li><li ng-class="{ active: currentPage === ('/concepts/connecting-with-asterisk.html') }"><a href=/concepts/connecting-with-asterisk.html>Connecting with Asterisk</a></li><li ng-class="{ active: currentPage === ('/concepts/libraries.html') }"><a href=/concepts/libraries.html>Libraries</a></li><li ng-class="{ active: currentPage === ('/concepts/rest-api.html') }"><a href=/concepts/rest-api.html>REST API Routes</a></li><li ng-class="{ active: currentPage === ('/concepts/roles-and-permissions.html') }"><a href=/concepts/roles-and-permissions.html>Roles &amp; Permissions</a></li></ul></li><li ng-class="{ active: currentPage === '/changelog.html' }"><a href=/changelog.html>Changelog</a></li><li>&nbsp;</li><li>Javascript Client<ul><li><a href=http://respoke.github.io/respoke target=_blank>Reference&nbsp;<i class="glyphicon glyphicon-share"></i></a></li><li ng-class="{ active: currentPage === ('/js-library/direct-connection.html') }"><a href=/js-library/direct-connection.html>Direct Connections</a></li><li ng-class="{ active: currentPage === ('/js-library/example-apps.html') }"><a href=/js-library/example-apps.html>Example Apps</a></li><li ng-class="{ active: currentPage === ('/js-library/respoke-js-logs.html') }"><a href=/js-library/respoke-js-logs.html>Respoke.js Logs</a></li><li ng-class="{ active: currentPage === ('/js-library/video-chat.html') }"><a href=/js-library/video-chat.html>Video Chat</a></li></ul></li><li>Admin API<ul><li>Coming soon</li></ul></li></ul></div></div><div class=col-md-7><div class=content-wrap><button id=sidebar-toggle-button onclick="$('#main-sidebar').toggle();$(this).find('i.glyphicon').toggleClass('hide');" class="btn btn xl btn-primary"><i class="glyphicon glyphicon-th-list"></i><i class="glyphicon glyphicon-remove hide"></i></button><article class=article><section class=content><h1 id=brokered-authentication-securing-your-application>Brokered Authentication: Securing Your Application</h1><h3 id=summary>Summary</h3><p>All client applications need an access token to connect to the Respoke service. The access token provides both authentication of who they are and authorization of what they are allowed to do. While an account is in development mode, applications can directly create Respoke access tokens without verification. This makes getting started easy, but is inherently insecure. In production, you will need to host a server to authenticate or verify a user and request a token on their behalf using the Admin API. This gives you fine-grained control over users and permissions. When you request a token, you simply need to provide an endpoint name, a set of permissions, and how long it is valid. In the simplest case, you could provide us an endpoint name and request all permissions. Once you receive a token from us, you provide this back in response to your user’s original request.</p><h3 id=how-it-works>How It Works</h3><p><a href=respoke-brokered-auth-flow.png><img src=respoke-brokered-auth-flow.png alt=authentication></a></p><h3 id=assumptions>Assumptions</h3><p>You already have a relationship with your end users to manage usernames, passwords, and permissions.</p><h3 id=1-client-s-token-request>1: Client’s Token Request</h3><p>Your user makes a request to your server, asking for a Respoke token.</p><h3 id=2-admin-api-token-request>2: Admin API - Token Request</h3><p>When your server receives the request for a token, it makes a token request to Respoke, adding the <strong>App Secret Key</strong> as a header, a time-to-live (ttl) in seconds to ensure tokens can’t be used very much later, and a named identifer also known as an “endpoint id”. This can be a random string but is often a username for simplicity. The <code>endpointId</code> is how the user will be known by Respoke, when they connect with the provided token response. You’ll also provide the id of a role representing a set of permissions that Respoke will use to allow or protect certain actions attempted by this endpoint. Roles can be created in your <a href="https://portal.respoke.io/">Dev Console</a>, and there is more information about working with roles in the <a href=/tutorials/roles-and-permissions.html>roles tutorial</a>.</p><pre><code class=xml>POST https://api.respoke.io/v1/tokens
Content-Type: application/json
App-Secret: 28B061B9-A0D4-4E52-A0ED-EB6EA125F82A
</code></pre><pre><code>{
    &quot;appId&quot;: &quot;34A9DDB9-D4AO-52AA-0ADE-EABEA521F2BA&quot;,
    &quot;endpointId&quot;: &quot;bobsmith&quot;,
    &quot;roleId&quot;: &quot;96070A0D-32B1-4B8C-9353-FE3E6A5E6C1D&quot;,
    &quot;ttl&quot;: 86400
}
</code></pre><h3 id=3-admin-api-token-response>3: Admin API - Token Response</h3><pre><code>{
    &quot;tokenId&quot;: &quot;7C5F4410-35A1-41AC-B8DE-295AF375B7D9&quot;,
    &quot;appId&quot;: &quot;28B061B9-A0D4-4E52-A0ED-EB6EA125F82A&quot;,
    &quot;endpointId&quot;: &quot;bobsmith&quot;,
    &quot;roleId&quot;: &quot;96070A0D-32B1-4B8C-9353-FE3E6A5E6C1D&quot;,
    &quot;createTime&quot;: 1395254788,
    &quot;expiryTime&quot;: 1395341188
}
</code></pre><h3 id=4-client-s-token-response>4: Client’s Token Response</h3><p>Your API responds to the user request in step 1. The only thing you need to return is the <code>tokenId</code>.</p><h3 id=5-client-api-client-connect->5: Client API - <code>client.connect()</code></h3><p><strong>JS Client Library Method</strong></p><p>The client application now uses the <a href=/js-library/respoke.html>Respoke JS library</a> to connect to Respoke using the token.</p><pre><code>client = respoke.createClient();

client.connect({
    reconnect: false, // disable automatic reconnection when not in development mode
    token: tokenId
    // callbacks go here
}); // or chain promises here
</code></pre><h3 id=6-a-note-about-automatic-reconnection>6: A note about automatic reconnection</h3><p>A new token is required on every connection. Because of this, when using brokered auth you’ll need to listen to the <code>disconnect</code> event and fetch a new token. Then use this new token to reconnect.</p><pre><code>client.listen(&#39;disconnect&#39;, function () {
    // trigger your code which fetches a token from your server
    getNewToken(function onSuccess(token) {
        client.connect({
            token: token
        });
    });
});
</code></pre><p><br></p><p><strong>REST API Method</strong></p><p>When using REST directly, you’ll need an application session token which you can get from the following API request. This token can be used to access the API directly by passing it with the request in an <code>App-Token</code> header. This happens automatically when using Respoke.js, the JavaScript client library.</p><h4 id=request>Request</h4><pre><code class=xml>POST https://api.respoke.io/v1/session-tokens
</code></pre><pre><code>{
    &quot;appId&quot;: &quot;D76D3B0A-35A1-41AC-A42D-FCE662BD1D96&quot;,
    &quot;tokenId&quot;: &quot;D5E3723F-5753-4FEC-AE1C-FCD805C157C6&quot;
}
</code></pre><h4 id=response>Response</h4><pre><code>{
    &quot;message&quot;: &quot;Authorization successful&quot;,
    &quot;token&quot;: &quot;F9B2F271-0D25-43CE-A910-DBBF4A54FE6F&quot;
}
</code></pre><p>Use the <code>token</code> string from the request as the value for the <code>App-Token</code> header for subsequent <a href=/reference/rest-api.html>REST API</a> requests.</p><h3 id=6-service-access>6: Service Access</h3><p>This is where you use the Respoke Client API for service access (sending messages, placing audio/video calls, and setting up datachannels for transferring data).</p><p><strong>JS Client Library Method</strong></p><pre><code>endpoint.call();
</code></pre><p><br></p><p><strong>REST API Method</strong></p><p>Example: TURN access One of the things that you can now do with the Client API (now that your client is a logged in endpoint) is to request TURN server credentials. Below is an example of this.</p><h4 id=request>Request</h4><pre><code class=xml>POST https://api.respoke.io/v1/turn
App-Token:F9B2F271-0D25-43CE-A910-DBBF4A54FE6F</code></pre><pre><code>{ } // no body needed
</code></pre><h4 id=response>Response</h4><pre><code>{
    &quot;username&quot;: &quot;3B35E769-A0E8-4B63-9881-35544EE0A158DC2654BD-170A-4D42-93A2-4E0EB4C560EB.1395342047&quot;,
    &quot;password&quot;: &quot;Gk4TtCYgGGcmheBXWFnnlm0kMVU=&quot;,
    &quot;ttl&quot;: 86400,
    &quot;uris&quot;: [
        &quot;turn:exampleturnurl.respoke.io:3478?transport=udp&quot;
    ]
}
</code></pre></section></article><br><br><br><br></div></div><div class=col-md-3></div></div></div></div></div></region></div><region><footer><div class=content-wrap><section class=copy><div class=footer><div class=footer-container><div class=footer-links><a href=http://digium.com/respoke><img src=/images/digium_white.png class=digium-logo></a></div><div class=footer-content><p class=copy>Copyright &copy; 2014 D.C.S, LLC</p><p class=copy><a href=mailto:info@respoke.io>info@respoke.io</a></p></div><div class="footer-links social-links"><a href=https://twitter.com/respoke><span class="fa fa-twitter"></span></a><a href=https://www.facebook.com/respokeIO><span class="fa fa-facebook"></span></a><a href=https://plus.google.com/110089434291590810767 rel=publisher><span class="fa fa-google-plus"></span></a></div></div></div></section></div></footer></region></div></body></html><script src=https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/stellar.js/0.6.2/jquery.stellar.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js></script><script>// Scrollspy
// TODO: use angular-ui boostrap version instead
$('body').scrollspy({ target: '.secondary-nav', offset: 150 });

// parallax by http://markdalgleish.com/projects/stellar.js/
$.stellar();

// affixing the sidebar at high resolutions
var resizeEvent = function(event){
  if($(window).width() > 990) {
      affixLeftSidebar();
  }
};
window.addEventListener('resize', resizeEvent);
resizeEvent();

// Showing and login and signup
(function () {
    var token = $.cookie('token');
    var $login = $('.log-in');
    var $logout = $('.log-out');
    var $signup = $('.sign-up');
    var $portal = $('.portal');
    var $wwwlink = $('.www-link');
    var $logo = $('img.logo');

    function loggedIn() {
        $login.remove();
        $signup.remove();

        $portal.css('display', 'inline-block');
        $logout.css('display', 'inline-block');
    }
    function notLoggedIn() {
        $portal.remove();
        $logout.remove();

        //- $login.css('display', 'inline-block');
        //- $signup.css('display', 'inline-block');
    }

    var apiBase = window.location.host.replace('docs', 'api').replace(':2003', ':2000');
    var apiUrl = apiBase.indexOf('testing.digiumlabs.com') !== -1 ? 'http://' : 'https://';
    apiUrl += apiBase + '/v1/admins/me';
    var publicBase = window.location.host.replace('docs', 'www').replace(':2003', ':2001');
    var publicUrl = publicBase.indexOf('testing.digiumlabs.com') !== -1 ? 'http://' : 'https://';
    publicUrl += publicBase;
    var portalBase = window.location.host.replace('docs', 'portal').replace(':2003', ':2002');
    var portalUrl = portalBase.indexOf('testing.digiumlabs.com') !== -1 ? 'http://' : 'https://';
    portalUrl += portalBase;

    if (token) {
        $.ajax({
            url: apiUrl,
            type: 'GET',
            headers: {
                'Admin-Token': token
            },
            success: loggedIn,
            error: notLoggedIn
        });
    }
    else {
        notLoggedIn();
    }

    $portal.attr('href', portalUrl + $portal.attr('href'));
    $wwwlink.each(function () {
        $(this).attr('href', publicUrl + $(this).attr('href'))
    });
    $logo.attr('src', publicUrl + $logo.attr('src').replace('https://www.respoke.io',''));
})();

function logout() {
    $.removeCookie('token', { domain: '.' + window.location.hostname.split('.').slice(-2).join('.') });
    window.location.reload();
}

$.ajax({
      url: '//d3px1qgagsf6ei.cloudfront.net/Scripts/f772acdb-7c45-430c-8c5a-28c3bcbb420e',
      crossDomain: true,
      dataType: 'script',
      success: function () {
          Payboard.Events.trackPage;
      },
      error: function () {
          console.log("There was an error retrieving the payboard tracking script");
      }
  });</script>